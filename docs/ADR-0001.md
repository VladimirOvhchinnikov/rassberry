# ADR-0001: Фрактальная платформа — контракты, порты, ограничения

**Решение.** Применяем фрактальную микроядерную архитектуру на Go: уровни Root/Domain/Function Kernel, единые контракты (Manifest, Exports, Imports, Health, Lifecycle), порты (RPC, EventBus, Stream, Logger), транспорт-агностика.

**Контракты.**
- `Manifest`: паспорт ядра (id, version, scope, features, requires/resources/security/compat).
- `Exports`: сеть (HTTP/gRPC/TCP), события (bus), стримы (broker), CLI, локальные сервисы.
- `Imports`: RPC/сервисы, подписки (events/streams), storages (sql/kv/blob и др.), env.
- `Health`: `ready|degraded|failed|draining|stopped` + причина + since.
- `Lifecycle`: `Load→Init→Configure→Start→Ready→Drain→Stop`.

**Порты.**
- `RPC` — регистрация сервисов, запуск сервера.
- `EventBus` — in-proc pub/sub (at-most-once).
- `Stream` — брокер-агностичная очередь (at-least-once).
- `Logger` — унификация логов (tee: локально + шина).

**Наблюдаемость.**
- Envelope с headers (`traceparent/tenant/zone`), `LogRecord(V2)`, SafeLogHub (rate-limit/drop/metrics).
- gRPC `LogGateway` для приёма логов от DK/FK, ретрансляция в `telemetry.logs.*`.

**Изоляция.**
- Супервизор с `RestartPolicy` и backoff+jitter.
- Деградация: скрытие экспортов проблемных ядер в discovery, остальная система работает.

**Ограничения/риски.**
- Версионирование экспортов и контрактов (`vN` в svc/topic), политика совместимости.
- Защита от лог-штормов, backpressure.
- Секьюрность: аутентификация отправителей логов, фильтрация секретов.
- Режимы `process/remote` — потребуют полноценного ProcessRunner и управления жизненным циклом.

**Альтернативы.**
- Полирепо с независимым релизным циклом (после стабилизации контрактов).
- Монолит с пакетной модульностью (хуже изоляция и эволюция).
